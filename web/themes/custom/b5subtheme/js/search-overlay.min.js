!function(e,t){"use strict";e.behaviors.searchOverlay={attach:function(e,s){e===document&&t("search-overlay-init",".utility-bar",e).forEach((function(){new i}))}};class i{constructor(){this.utilityBar=document.querySelector(".utility-bar"),this.searchOverlay=document.getElementById("searchOverlay"),this.searchToggle=document.getElementById("searchToggle"),this.utilityBarContent=document.getElementById("utilityBarContent"),this.searchInput=null,this.searchResults=null,this.searchLoading=null,this.searchTimeout=null,this.isOpen=!1,this.abortController=null,this.searchOverlay&&this.searchToggle&&this.utilityBarContent&&this.init()}init(){const e=this.utilityBar.querySelector(".container");this.searchOverlay.parentElement!==e&&e.appendChild(this.searchOverlay),this.searchOverlay.style.display="none",this.searchOverlay.style.height="100%",this.searchOverlay.setAttribute("aria-hidden","true"),this.searchInput=this.searchOverlay.querySelector(".search-input"),this.searchResults=this.searchOverlay.querySelector(".search-results-dropdown"),this.searchLoading=this.searchOverlay.querySelector(".search-loading"),this.bindEvents()}bindEvents(){this.searchToggle.addEventListener("click",(e=>{e.preventDefault(),this.toggleSearch()}));const e=this.searchOverlay.querySelector(".search-close");e&&e.addEventListener("click",(e=>{e.preventDefault(),this.closeSearch()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&this.isOpen&&this.closeSearch()}));const t=this.searchOverlay.querySelector("form");t&&t.addEventListener("submit",(e=>{e.preventDefault();const t=this.searchInput.value.trim();t.length>0&&(window.location.href=`/search?keys=${encodeURIComponent(t)}`)})),this.searchInput&&(this.searchInput.addEventListener("input",(e=>{this.handleSearchInput(e.target.value)})),this.searchInput.addEventListener("keydown",(e=>{this.handleResultsNavigation(e)}))),document.addEventListener("click",(e=>{this.isOpen&&!this.searchOverlay.contains(e.target)&&this.hideResults()}))}toggleSearch(){this.isOpen?this.closeSearch():this.openSearch()}openSearch(){this.utilityBarContent.style.display="none",this.searchOverlay.style.display="flex",this.searchOverlay.setAttribute("aria-hidden","false"),this.searchToggle.setAttribute("aria-expanded","true"),this.searchInput&&setTimeout((()=>{this.searchInput.focus()}),100),this.isOpen=!0}closeSearch(){this.abortController&&this.abortController.abort(),this.utilityBarContent.style.display="flex",this.searchOverlay.style.display="none",this.searchOverlay.setAttribute("aria-hidden","true"),this.searchToggle.setAttribute("aria-expanded","false"),this.searchInput&&(this.searchInput.value=""),this.hideResults(),this.searchToggle.focus(),this.isOpen=!1}handleSearchInput(e){this.searchTimeout&&clearTimeout(this.searchTimeout),this.abortController&&this.abortController.abort();const t=e.trim();0===t.length?this.hideResults():this.searchTimeout=setTimeout((()=>{t.length>=2&&this.performSearch(t)}),300)}async performSearch(e){this.showLoading(),this.abortController=new AbortController;try{const t=await fetch(`/search/node?keys=${encodeURIComponent(e)}&_format=json`,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},signal:this.abortController.signal});if(!t.ok)throw new Error("Search request failed");const i=await t.json();this.displayResults(i,e)}catch(e){"AbortError"!==e.name&&(console.error("Search error:",e),this.showError())}finally{this.hideLoading()}}displayResults(e,t){const i=this.searchResults.querySelector(".search-results-content");if(e&&0!==e.length){const s=e.slice(0,5).map((e=>{const i=this.highlightMatch(e.title||"Untitled",t),s=e.snippet?this.highlightMatch(e.snippet,t):"",r=e.link||"#";return`\n            <a href="${r}" class="search-result-item" tabindex="0">\n              <div class="search-result-title">${i}</div>\n              ${s?`<div class="search-result-snippet">${s}</div>`:""}\n            </a>\n          `})).join("");i.innerHTML=s,e.length>5&&(i.innerHTML+=`\n            <a href="/search?keys=${encodeURIComponent(t)}" class="search-view-all">\n              View all ${e.length} results <i class="fa-solid fa-arrow-right"></i>\n            </a>\n          `)}else i.innerHTML=`\n          <div class="search-no-results">\n            <p>No results found for "<strong>${this.escapeHtml(t)}</strong>"</p>\n          </div>\n        `;this.showResults()}highlightMatch(e,t){const i=this.escapeHtml(e),s=new RegExp(`(${this.escapeRegex(t)})`,"gi");return i.replace(s,"<mark>$1</mark>")}showResults(){this.searchResults.style.display="block";const e=this.searchOverlay.querySelector(".search-input-wrapper").getBoundingClientRect();this.searchResults.style.top=e.height+5+"px"}hideResults(){this.searchResults.style.display="none"}showLoading(){this.searchLoading&&(this.searchLoading.style.display="flex")}hideLoading(){this.searchLoading&&(this.searchLoading.style.display="none")}showError(){this.searchResults.querySelector(".search-results-content").innerHTML='\n        <div class="search-error">\n          <p>An error occurred while searching. Please try again.</p>\n        </div>\n      ',this.showResults()}handleResultsNavigation(e){const t=this.searchResults.querySelectorAll(".search-result-item, .search-view-all"),i=Array.from(t).findIndex((e=>e===document.activeElement));switch(e.key){case"ArrowDown":e.preventDefault(),i<t.length-1?t[i+1].focus():-1===i&&t.length>0&&t[0].focus();break;case"ArrowUp":e.preventDefault(),i>0?t[i-1].focus():0===i&&this.searchInput.focus()}}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}}(Drupal,once);